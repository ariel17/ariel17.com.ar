<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet type="text/xsl" href="../assets/xml/rss.xsl" media="all"?><rss xmlns:atom="http://www.w3.org/2005/Atom" version="2.0" xmlns:dc="http://purl.org/dc/elements/1.1/"><channel><title>Ariel Gerardo Ríos (social)</title><link>https://example.com/</link><description></description><atom:link href="http://ariel17.com.ar/categories/social.xml" type="application/rss+xml" rel="self"></atom:link><language>es</language><lastBuildDate>Sun, 25 Mar 2018 15:00:00 GMT</lastBuildDate><generator>https://getnikola.com/</generator><docs>http://blogs.law.harvard.edu/tech/rss</docs><item><title>Links for 2016-09-23</title><link>http://ariel17.com.ar/blog/links-for-2016-09-23/</link><dc:creator>Ariel Gerardo Ríos</dc:creator><description>&lt;ul class="simple"&gt;
&lt;li&gt;&lt;a class="reference external" href="https://www.gitbook.com/book/hintjens/social-architecture/details"&gt;Social Architecture&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="https://www.gitbook.com/book/hintjens/psychopathcode/details"&gt;The Psychopath Code&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</description><category>books</category><category>code</category><category>links</category><category>social</category><guid>http://ariel17.com.ar/blog/links-for-2016-09-23/</guid><pubDate>Sat, 24 Sep 2016 02:19:17 GMT</pubDate></item><item><title>Renovando tokens en Django para Google Oauth2, de la manera difícil</title><link>http://ariel17.com.ar/blog/refreshing-tokens-on-django-for-google-oauth2-the-hard-way/</link><dc:creator>Ariel Gerardo Ríos</dc:creator><description>&lt;div&gt;&lt;p&gt;Cuando digo &lt;em&gt;de la manera difícil&lt;/em&gt; quiero decir que fue MUY difícil &lt;em&gt;para mí&lt;/em&gt;
encontrar la combinación correcta de configuraciones para tener funcionando
&lt;a class="reference external" href="https://www.djangoproject.com/"&gt;Django&lt;/a&gt; combinado con &lt;a class="reference external" href="http://psa.matiasaguirre.net/"&gt;python-social-auth&lt;/a&gt; y &lt;a class="reference external" href="https://developers.google.com/api-client-library/python/"&gt;google-api-python-client&lt;/a&gt;. El
escenario era tan simple y sin embargo tan complicado de hacerlo funcionar como
debía, que estoy un poco frustrado.&lt;/p&gt;
&lt;div class="section" id="el-escenario"&gt;
&lt;h2&gt;El escenario&lt;/h2&gt;
&lt;p&gt;Sincronizar un evento propio del usuario hacia su cuenta de Google Calendar, no
en ambas direcciones sino sólo &lt;code&gt;Django -&amp;gt; GCalendar&lt;/code&gt;. El usuario debe
autenticar la cuenta para usar la sincronización sólo una vez, pero los tokens
de &lt;a class="reference external" href="https://developers.google.com/accounts/docs/OAuth2"&gt;Google Oauth2&lt;/a&gt; tienen 1 hora de tiempo de vida, así que tienen que ser
renovados o solicitarle al usuario que autorice la aplicación nuevamente.
Ningún dato del usuario se debe actualizar.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="el-ambiente-django"&gt;
&lt;h2&gt;El ambiente Django&lt;/h2&gt;
&lt;p&gt;Google ya cuenta con la biblioteca &lt;a class="reference external" href="https://developers.google.com/api-client-library/python/"&gt;google-api-python-client&lt;/a&gt; para facilitar la
implementación de los flujos de autenticación pero yo quise usar una biblioteca
que tiene una manera más elegante de hacerlo: &lt;a class="reference external" href="http://psa.matiasaguirre.net/"&gt;python-social-auth&lt;/a&gt;. Este úlltimo
también permite hacer uso de &lt;a class="reference external" href="http://psa.matiasaguirre.net/docs/backends/index.html#social-backends"&gt;muchos otros backends&lt;/a&gt; muy fácilmente, no sólo
Google y &lt;a class="reference external" href="http://psa.matiasaguirre.net/docs/backends/index.html#non-social-backends"&gt;no sólo sociales&lt;/a&gt;. Así que esto es lo que tengo:&lt;/p&gt;
&lt;pre class="code text"&gt;&lt;a name="rest_code_027739845ee34c219866ae39cece9e58-1"&gt;&lt;/a&gt;# Requerimientos
&lt;a name="rest_code_027739845ee34c219866ae39cece9e58-2"&gt;&lt;/a&gt;Django==1.7
&lt;a name="rest_code_027739845ee34c219866ae39cece9e58-3"&gt;&lt;/a&gt;python-social-auth==0.2.1
&lt;a name="rest_code_027739845ee34c219866ae39cece9e58-4"&gt;&lt;/a&gt;google-api-python-client==1.2
&lt;a name="rest_code_027739845ee34c219866ae39cece9e58-5"&gt;&lt;/a&gt;raven==5.0.0  # *realmente* deberia tener Sentry! https://getsentry.com/
&lt;a name="rest_code_027739845ee34c219866ae39cece9e58-6"&gt;&lt;/a&gt;requests==2.3.0
&lt;/pre&gt;&lt;p&gt;Y las configuraciones relacionadas en &lt;code&gt;settings.py&lt;/code&gt;:&lt;/p&gt;
&lt;pre class="code python"&gt;&lt;a name="rest_code_59d3fd63f4f44eb49e27f470ce3234ab-1"&gt;&lt;/a&gt;&lt;span class="c"&gt;# project/settings.py&lt;/span&gt;
&lt;a name="rest_code_59d3fd63f4f44eb49e27f470ce3234ab-2"&gt;&lt;/a&gt;
&lt;a name="rest_code_59d3fd63f4f44eb49e27f470ce3234ab-3"&gt;&lt;/a&gt;&lt;span class="n"&gt;AUTHENTICATION_BACKENDS&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;
&lt;a name="rest_code_59d3fd63f4f44eb49e27f470ce3234ab-4"&gt;&lt;/a&gt;    &lt;span class="s"&gt;'social.backends.google.GoogleOAuth2'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;a name="rest_code_59d3fd63f4f44eb49e27f470ce3234ab-5"&gt;&lt;/a&gt;    &lt;span class="s"&gt;'django.contrib.auth.backends.ModelBackend'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;a name="rest_code_59d3fd63f4f44eb49e27f470ce3234ab-6"&gt;&lt;/a&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a name="rest_code_59d3fd63f4f44eb49e27f470ce3234ab-7"&gt;&lt;/a&gt;
&lt;a name="rest_code_59d3fd63f4f44eb49e27f470ce3234ab-8"&gt;&lt;/a&gt;&lt;span class="n"&gt;SOCIAL_AUTH_LOGIN_REDIRECT_URL&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;'/home/'&lt;/span&gt;
&lt;a name="rest_code_59d3fd63f4f44eb49e27f470ce3234ab-9"&gt;&lt;/a&gt;
&lt;a name="rest_code_59d3fd63f4f44eb49e27f470ce3234ab-10"&gt;&lt;/a&gt;&lt;span class="n"&gt;SOCIAL_AUTH_LOGIN_ERROR_URL&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;SOCIAL_AUTH_LOGIN_REDIRECT_URL&lt;/span&gt;
&lt;a name="rest_code_59d3fd63f4f44eb49e27f470ce3234ab-11"&gt;&lt;/a&gt;
&lt;a name="rest_code_59d3fd63f4f44eb49e27f470ce3234ab-12"&gt;&lt;/a&gt;&lt;span class="n"&gt;SOCIAL_AUTH_DISCONNECT_REDIRECT_URL&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;SOCIAL_AUTH_LOGIN_REDIRECT_URL&lt;/span&gt;
&lt;a name="rest_code_59d3fd63f4f44eb49e27f470ce3234ab-13"&gt;&lt;/a&gt;
&lt;a name="rest_code_59d3fd63f4f44eb49e27f470ce3234ab-14"&gt;&lt;/a&gt;&lt;span class="n"&gt;SOCIAL_AUTH_GOOGLE_OAUTH2_SCOPE&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;
&lt;a name="rest_code_59d3fd63f4f44eb49e27f470ce3234ab-15"&gt;&lt;/a&gt;    &lt;span class="s"&gt;'https://www.googleapis.com/auth/calendar'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;a name="rest_code_59d3fd63f4f44eb49e27f470ce3234ab-16"&gt;&lt;/a&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;a name="rest_code_59d3fd63f4f44eb49e27f470ce3234ab-17"&gt;&lt;/a&gt;
&lt;a name="rest_code_59d3fd63f4f44eb49e27f470ce3234ab-18"&gt;&lt;/a&gt;&lt;span class="n"&gt;SOCIAL_AUTH_GOOGLE_OAUTH2_AUTH_EXTRA_ARGUMENTS&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;a name="rest_code_59d3fd63f4f44eb49e27f470ce3234ab-19"&gt;&lt;/a&gt;    &lt;span class="s"&gt;'access_type'&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s"&gt;'offline'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;  &lt;span class="c"&gt;# Activa el permiso de renovación&lt;/span&gt;
&lt;a name="rest_code_59d3fd63f4f44eb49e27f470ce3234ab-20"&gt;&lt;/a&gt;    &lt;span class="s"&gt;'approval_promt'&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s"&gt;'force'&lt;/span&gt;  &lt;span class="c"&gt;# Activa refresh_token&lt;/span&gt;
&lt;a name="rest_code_59d3fd63f4f44eb49e27f470ce3234ab-21"&gt;&lt;/a&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;a name="rest_code_59d3fd63f4f44eb49e27f470ce3234ab-22"&gt;&lt;/a&gt;
&lt;a name="rest_code_59d3fd63f4f44eb49e27f470ce3234ab-23"&gt;&lt;/a&gt;&lt;span class="n"&gt;SOCIAL_AUTH_PIPELINE&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;  &lt;span class="c"&gt;# Quitado creación de usuario y actualización del perfil&lt;/span&gt;
&lt;a name="rest_code_59d3fd63f4f44eb49e27f470ce3234ab-24"&gt;&lt;/a&gt;    &lt;span class="s"&gt;'social.pipeline.social_auth.social_details'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;a name="rest_code_59d3fd63f4f44eb49e27f470ce3234ab-25"&gt;&lt;/a&gt;    &lt;span class="s"&gt;'social.pipeline.social_auth.social_uid'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;a name="rest_code_59d3fd63f4f44eb49e27f470ce3234ab-26"&gt;&lt;/a&gt;    &lt;span class="s"&gt;'social.pipeline.social_auth.auth_allowed'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;a name="rest_code_59d3fd63f4f44eb49e27f470ce3234ab-27"&gt;&lt;/a&gt;    &lt;span class="s"&gt;'social.pipeline.social_auth.associate_user'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;a name="rest_code_59d3fd63f4f44eb49e27f470ce3234ab-28"&gt;&lt;/a&gt;    &lt;span class="s"&gt;'social.pipeline.social_auth.load_extra_data'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;a name="rest_code_59d3fd63f4f44eb49e27f470ce3234ab-29"&gt;&lt;/a&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;p&gt;Lo que hace toda la magia es el argumento extra &lt;code&gt;approval_promt&lt;/code&gt; porque
Google sólo envía el &lt;code&gt;refresh_token&lt;/code&gt; cuando está presente. No importa el
hecho de que uno ya indicó el tipo de acceso offline: cuando el momento de la
renovación llegue uno sólo puede hacerlo usando ese valor, ningún otro es
válido. &lt;strong&gt;Por favor, refútenme.&lt;/strong&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="sincronizando-y-renovando"&gt;
&lt;h2&gt;Sincronizando y renovando&lt;/h2&gt;
&lt;p&gt;Un modelo que representa un evento de usario con sincronización + renovación
del token cuando sucede un error de autenticación:&lt;/p&gt;
&lt;pre class="code python"&gt;&lt;a name="rest_code_5a62c5ca531948e5bd64635ffa75eaf9-1"&gt;&lt;/a&gt;&lt;span class="c"&gt;#!/usr/bin/env python&lt;/span&gt;
&lt;a name="rest_code_5a62c5ca531948e5bd64635ffa75eaf9-2"&gt;&lt;/a&gt;&lt;span class="c"&gt;# -*- coding: utf-8 -*-&lt;/span&gt;
&lt;a name="rest_code_5a62c5ca531948e5bd64635ffa75eaf9-3"&gt;&lt;/a&gt;
&lt;a name="rest_code_5a62c5ca531948e5bd64635ffa75eaf9-4"&gt;&lt;/a&gt;&lt;span class="sd"&gt;"""&lt;/span&gt;
&lt;a name="rest_code_5a62c5ca531948e5bd64635ffa75eaf9-5"&gt;&lt;/a&gt;&lt;span class="sd"&gt;Model definition for appliation ``app``.&lt;/span&gt;
&lt;a name="rest_code_5a62c5ca531948e5bd64635ffa75eaf9-6"&gt;&lt;/a&gt;&lt;span class="sd"&gt;"""&lt;/span&gt;
&lt;a name="rest_code_5a62c5ca531948e5bd64635ffa75eaf9-7"&gt;&lt;/a&gt;
&lt;a name="rest_code_5a62c5ca531948e5bd64635ffa75eaf9-8"&gt;&lt;/a&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;logging&lt;/span&gt;
&lt;a name="rest_code_5a62c5ca531948e5bd64635ffa75eaf9-9"&gt;&lt;/a&gt;
&lt;a name="rest_code_5a62c5ca531948e5bd64635ffa75eaf9-10"&gt;&lt;/a&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;apiclient.discovery&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;build&lt;/span&gt;
&lt;a name="rest_code_5a62c5ca531948e5bd64635ffa75eaf9-11"&gt;&lt;/a&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;oauth2client.client&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;AccessTokenCredentials&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;AccessTokenCredentialsError&lt;/span&gt;
&lt;a name="rest_code_5a62c5ca531948e5bd64635ffa75eaf9-12"&gt;&lt;/a&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;requests.exceptions&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;HTTPError&lt;/span&gt;
&lt;a name="rest_code_5a62c5ca531948e5bd64635ffa75eaf9-13"&gt;&lt;/a&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;httplib2&lt;/span&gt;
&lt;a name="rest_code_5a62c5ca531948e5bd64635ffa75eaf9-14"&gt;&lt;/a&gt;
&lt;a name="rest_code_5a62c5ca531948e5bd64635ffa75eaf9-15"&gt;&lt;/a&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;django.contrib.auth.models&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;User&lt;/span&gt;
&lt;a name="rest_code_5a62c5ca531948e5bd64635ffa75eaf9-16"&gt;&lt;/a&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;django.db&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;models&lt;/span&gt;
&lt;a name="rest_code_5a62c5ca531948e5bd64635ffa75eaf9-17"&gt;&lt;/a&gt;
&lt;a name="rest_code_5a62c5ca531948e5bd64635ffa75eaf9-18"&gt;&lt;/a&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;social.apps.django_app.default.models&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;UserSocialAuth&lt;/span&gt;
&lt;a name="rest_code_5a62c5ca531948e5bd64635ffa75eaf9-19"&gt;&lt;/a&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;social.apps.django_app.utils&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;load_strategy&lt;/span&gt;
&lt;a name="rest_code_5a62c5ca531948e5bd64635ffa75eaf9-20"&gt;&lt;/a&gt;
&lt;a name="rest_code_5a62c5ca531948e5bd64635ffa75eaf9-21"&gt;&lt;/a&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;app.models&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;Event&lt;/span&gt;
&lt;a name="rest_code_5a62c5ca531948e5bd64635ffa75eaf9-22"&gt;&lt;/a&gt;
&lt;a name="rest_code_5a62c5ca531948e5bd64635ffa75eaf9-23"&gt;&lt;/a&gt;
&lt;a name="rest_code_5a62c5ca531948e5bd64635ffa75eaf9-24"&gt;&lt;/a&gt;&lt;span class="n"&gt;logger&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;logging&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;getLogger&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;__name__&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a name="rest_code_5a62c5ca531948e5bd64635ffa75eaf9-25"&gt;&lt;/a&gt;
&lt;a name="rest_code_5a62c5ca531948e5bd64635ffa75eaf9-26"&gt;&lt;/a&gt;
&lt;a name="rest_code_5a62c5ca531948e5bd64635ffa75eaf9-27"&gt;&lt;/a&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;CustomEvent&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;models&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Model&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
&lt;a name="rest_code_5a62c5ca531948e5bd64635ffa75eaf9-28"&gt;&lt;/a&gt;    &lt;span class="sd"&gt;"""&lt;/span&gt;
&lt;a name="rest_code_5a62c5ca531948e5bd64635ffa75eaf9-29"&gt;&lt;/a&gt;&lt;span class="sd"&gt;    A very simple custom event model.&lt;/span&gt;
&lt;a name="rest_code_5a62c5ca531948e5bd64635ffa75eaf9-30"&gt;&lt;/a&gt;&lt;span class="sd"&gt;    """&lt;/span&gt;
&lt;a name="rest_code_5a62c5ca531948e5bd64635ffa75eaf9-31"&gt;&lt;/a&gt;    &lt;span class="n"&gt;name&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;models&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;CharField&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;max_length&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;200&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a name="rest_code_5a62c5ca531948e5bd64635ffa75eaf9-32"&gt;&lt;/a&gt;    &lt;span class="n"&gt;description&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;models&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;CharField&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;max_length&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;200&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a name="rest_code_5a62c5ca531948e5bd64635ffa75eaf9-33"&gt;&lt;/a&gt;    &lt;span class="n"&gt;user&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;models&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;ForeignKey&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;User&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a name="rest_code_5a62c5ca531948e5bd64635ffa75eaf9-34"&gt;&lt;/a&gt;
&lt;a name="rest_code_5a62c5ca531948e5bd64635ffa75eaf9-35"&gt;&lt;/a&gt;    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;__unicode__&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
&lt;a name="rest_code_5a62c5ca531948e5bd64635ffa75eaf9-36"&gt;&lt;/a&gt;        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="s"&gt;u"{0} ({1})"&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;pk&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a name="rest_code_5a62c5ca531948e5bd64635ffa75eaf9-37"&gt;&lt;/a&gt;
&lt;a name="rest_code_5a62c5ca531948e5bd64635ffa75eaf9-38"&gt;&lt;/a&gt;    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;get_google_data&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
&lt;a name="rest_code_5a62c5ca531948e5bd64635ffa75eaf9-39"&gt;&lt;/a&gt;        &lt;span class="sd"&gt;"""&lt;/span&gt;
&lt;a name="rest_code_5a62c5ca531948e5bd64635ffa75eaf9-40"&gt;&lt;/a&gt;&lt;span class="sd"&gt;        Implementing the Calendar API content required to create an event:&lt;/span&gt;
&lt;a name="rest_code_5a62c5ca531948e5bd64635ffa75eaf9-41"&gt;&lt;/a&gt;&lt;span class="sd"&gt;        https://developers.google.com/google-apps/calendar/v3/reference/events?hl=es#resource&lt;/span&gt;
&lt;a name="rest_code_5a62c5ca531948e5bd64635ffa75eaf9-42"&gt;&lt;/a&gt;&lt;span class="sd"&gt;        """&lt;/span&gt;
&lt;a name="rest_code_5a62c5ca531948e5bd64635ffa75eaf9-43"&gt;&lt;/a&gt;        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="p"&gt;{}&lt;/span&gt;  &lt;span class="c"&gt;# dummy of course&lt;/span&gt;
&lt;a name="rest_code_5a62c5ca531948e5bd64635ffa75eaf9-44"&gt;&lt;/a&gt;
&lt;a name="rest_code_5a62c5ca531948e5bd64635ffa75eaf9-45"&gt;&lt;/a&gt;    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;sync_event&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;retry&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="bp"&gt;True&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
&lt;a name="rest_code_5a62c5ca531948e5bd64635ffa75eaf9-46"&gt;&lt;/a&gt;        &lt;span class="sd"&gt;"""&lt;/span&gt;
&lt;a name="rest_code_5a62c5ca531948e5bd64635ffa75eaf9-47"&gt;&lt;/a&gt;&lt;span class="sd"&gt;        Pushes current event to the user's Google Calendar service, if it is enabled.&lt;/span&gt;
&lt;a name="rest_code_5a62c5ca531948e5bd64635ffa75eaf9-48"&gt;&lt;/a&gt;
&lt;a name="rest_code_5a62c5ca531948e5bd64635ffa75eaf9-49"&gt;&lt;/a&gt;&lt;span class="sd"&gt;        :param retry: Indicates if it should retry on an authentication error.&lt;/span&gt;
&lt;a name="rest_code_5a62c5ca531948e5bd64635ffa75eaf9-50"&gt;&lt;/a&gt;&lt;span class="sd"&gt;        :type retry: ``bool``&lt;/span&gt;
&lt;a name="rest_code_5a62c5ca531948e5bd64635ffa75eaf9-51"&gt;&lt;/a&gt;&lt;span class="sd"&gt;        :return: Synchronization result from Google API.&lt;/span&gt;
&lt;a name="rest_code_5a62c5ca531948e5bd64635ffa75eaf9-52"&gt;&lt;/a&gt;&lt;span class="sd"&gt;        :rtype: ``dict`` or ``None``&lt;/span&gt;
&lt;a name="rest_code_5a62c5ca531948e5bd64635ffa75eaf9-53"&gt;&lt;/a&gt;&lt;span class="sd"&gt;        """&lt;/span&gt;
&lt;a name="rest_code_5a62c5ca531948e5bd64635ffa75eaf9-54"&gt;&lt;/a&gt;        &lt;span class="k"&gt;try&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;a name="rest_code_5a62c5ca531948e5bd64635ffa75eaf9-55"&gt;&lt;/a&gt;            &lt;span class="n"&gt;provider&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;social_auth&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;provider&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;'google-oauth2'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a name="rest_code_5a62c5ca531948e5bd64635ffa75eaf9-56"&gt;&lt;/a&gt;        &lt;span class="k"&gt;except&lt;/span&gt; &lt;span class="n"&gt;UserSocialAuth&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;DoesNotExist&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;a name="rest_code_5a62c5ca531948e5bd64635ffa75eaf9-57"&gt;&lt;/a&gt;            &lt;span class="n"&gt;logger&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;debug&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;u"Google is not authenticated; nothing to do :("&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a name="rest_code_5a62c5ca531948e5bd64635ffa75eaf9-58"&gt;&lt;/a&gt;            &lt;span class="k"&gt;return&lt;/span&gt;
&lt;a name="rest_code_5a62c5ca531948e5bd64635ffa75eaf9-59"&gt;&lt;/a&gt;
&lt;a name="rest_code_5a62c5ca531948e5bd64635ffa75eaf9-60"&gt;&lt;/a&gt;        &lt;span class="n"&gt;logger&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;debug&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;u'Syncronizing event &lt;/span&gt;&lt;span class="si"&gt;%r&lt;/span&gt;&lt;span class="s"&gt; into Google Calendar for user &lt;/span&gt;&lt;span class="si"&gt;%r&lt;/span&gt;&lt;span class="s"&gt;'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;a name="rest_code_5a62c5ca531948e5bd64635ffa75eaf9-61"&gt;&lt;/a&gt;                     &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a name="rest_code_5a62c5ca531948e5bd64635ffa75eaf9-62"&gt;&lt;/a&gt;
&lt;a name="rest_code_5a62c5ca531948e5bd64635ffa75eaf9-63"&gt;&lt;/a&gt;        &lt;span class="n"&gt;credentials&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;AccessTokenCredentials&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
&lt;a name="rest_code_5a62c5ca531948e5bd64635ffa75eaf9-64"&gt;&lt;/a&gt;            &lt;span class="n"&gt;provider&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;extra_data&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s"&gt;'access_token'&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="s"&gt;'my-user-agent/1.0'&lt;/span&gt;
&lt;a name="rest_code_5a62c5ca531948e5bd64635ffa75eaf9-65"&gt;&lt;/a&gt;        &lt;span class="p"&gt;)&lt;/span&gt;
&lt;a name="rest_code_5a62c5ca531948e5bd64635ffa75eaf9-66"&gt;&lt;/a&gt;        &lt;span class="n"&gt;http&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;httplib2&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Http&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;a name="rest_code_5a62c5ca531948e5bd64635ffa75eaf9-67"&gt;&lt;/a&gt;        &lt;span class="n"&gt;http&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;credentials&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;authorize&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;http&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a name="rest_code_5a62c5ca531948e5bd64635ffa75eaf9-68"&gt;&lt;/a&gt;        &lt;span class="n"&gt;service&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;build&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;serviceName&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;'calendar'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;version&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;'v3'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;http&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;http&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a name="rest_code_5a62c5ca531948e5bd64635ffa75eaf9-69"&gt;&lt;/a&gt;
&lt;a name="rest_code_5a62c5ca531948e5bd64635ffa75eaf9-70"&gt;&lt;/a&gt;        &lt;span class="n"&gt;data&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;get_google_data&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a name="rest_code_5a62c5ca531948e5bd64635ffa75eaf9-71"&gt;&lt;/a&gt;        &lt;span class="n"&gt;logger&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;debug&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;u'Creating event with data: &lt;/span&gt;&lt;span class="si"&gt;%r&lt;/span&gt;&lt;span class="s"&gt;'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a name="rest_code_5a62c5ca531948e5bd64635ffa75eaf9-72"&gt;&lt;/a&gt;
&lt;a name="rest_code_5a62c5ca531948e5bd64635ffa75eaf9-73"&gt;&lt;/a&gt;        &lt;span class="k"&gt;try&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;a name="rest_code_5a62c5ca531948e5bd64635ffa75eaf9-74"&gt;&lt;/a&gt;            &lt;span class="n"&gt;result&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;service&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;events&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;insert&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
&lt;a name="rest_code_5a62c5ca531948e5bd64635ffa75eaf9-75"&gt;&lt;/a&gt;                &lt;span class="n"&gt;calendarId&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;'primary'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;body&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;
&lt;a name="rest_code_5a62c5ca531948e5bd64635ffa75eaf9-76"&gt;&lt;/a&gt;            &lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;execute&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;a name="rest_code_5a62c5ca531948e5bd64635ffa75eaf9-77"&gt;&lt;/a&gt;
&lt;a name="rest_code_5a62c5ca531948e5bd64635ffa75eaf9-78"&gt;&lt;/a&gt;        &lt;span class="k"&gt;except&lt;/span&gt; &lt;span class="n"&gt;AccessTokenCredentialsError&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;a name="rest_code_5a62c5ca531948e5bd64635ffa75eaf9-79"&gt;&lt;/a&gt;            &lt;span class="n"&gt;result&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="bp"&gt;None&lt;/span&gt;
&lt;a name="rest_code_5a62c5ca531948e5bd64635ffa75eaf9-80"&gt;&lt;/a&gt;            &lt;span class="k"&gt;try&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;a name="rest_code_5a62c5ca531948e5bd64635ffa75eaf9-81"&gt;&lt;/a&gt;                &lt;span class="n"&gt;provider&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;refresh_token&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;load_strategy&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;
&lt;a name="rest_code_5a62c5ca531948e5bd64635ffa75eaf9-82"&gt;&lt;/a&gt;            &lt;span class="k"&gt;except&lt;/span&gt; &lt;span class="n"&gt;HTTPError&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;a name="rest_code_5a62c5ca531948e5bd64635ffa75eaf9-83"&gt;&lt;/a&gt;                &lt;span class="n"&gt;provider&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;delete&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;a name="rest_code_5a62c5ca531948e5bd64635ffa75eaf9-84"&gt;&lt;/a&gt;                &lt;span class="n"&gt;logger&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;error&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
&lt;a name="rest_code_5a62c5ca531948e5bd64635ffa75eaf9-85"&gt;&lt;/a&gt;                    &lt;span class="s"&gt;u"Error trying to refesh token. Authorization object "&lt;/span&gt;
&lt;a name="rest_code_5a62c5ca531948e5bd64635ffa75eaf9-86"&gt;&lt;/a&gt;                    &lt;span class="s"&gt;"was removed."&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;exc_info&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="bp"&gt;True&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;extra&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;
&lt;a name="rest_code_5a62c5ca531948e5bd64635ffa75eaf9-87"&gt;&lt;/a&gt;                        &lt;span class="s"&gt;u'response'&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;a name="rest_code_5a62c5ca531948e5bd64635ffa75eaf9-88"&gt;&lt;/a&gt;                            &lt;span class="s"&gt;u'body'&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;response&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;content&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;a name="rest_code_5a62c5ca531948e5bd64635ffa75eaf9-89"&gt;&lt;/a&gt;                            &lt;span class="s"&gt;u'url'&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;response&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;url&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;a name="rest_code_5a62c5ca531948e5bd64635ffa75eaf9-90"&gt;&lt;/a&gt;                            &lt;span class="s"&gt;u'status_code'&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;response&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;status_code&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;a name="rest_code_5a62c5ca531948e5bd64635ffa75eaf9-91"&gt;&lt;/a&gt;                        &lt;span class="p"&gt;},&lt;/span&gt;
&lt;a name="rest_code_5a62c5ca531948e5bd64635ffa75eaf9-92"&gt;&lt;/a&gt;                        &lt;span class="s"&gt;u'request'&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;a name="rest_code_5a62c5ca531948e5bd64635ffa75eaf9-93"&gt;&lt;/a&gt;                            &lt;span class="s"&gt;u'url'&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;response&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;url&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;a name="rest_code_5a62c5ca531948e5bd64635ffa75eaf9-94"&gt;&lt;/a&gt;                            &lt;span class="s"&gt;u'method'&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;response&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;method&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;a name="rest_code_5a62c5ca531948e5bd64635ffa75eaf9-95"&gt;&lt;/a&gt;                            &lt;span class="s"&gt;u'body'&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;response&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;body&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;a name="rest_code_5a62c5ca531948e5bd64635ffa75eaf9-96"&gt;&lt;/a&gt;                        &lt;span class="p"&gt;},&lt;/span&gt;
&lt;a name="rest_code_5a62c5ca531948e5bd64635ffa75eaf9-97"&gt;&lt;/a&gt;                    &lt;span class="p"&gt;})&lt;/span&gt;
&lt;a name="rest_code_5a62c5ca531948e5bd64635ffa75eaf9-98"&gt;&lt;/a&gt;
&lt;a name="rest_code_5a62c5ca531948e5bd64635ffa75eaf9-99"&gt;&lt;/a&gt;        &lt;span class="k"&gt;except&lt;/span&gt; &lt;span class="ne"&gt;Exception&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;a name="rest_code_5a62c5ca531948e5bd64635ffa75eaf9-100"&gt;&lt;/a&gt;            &lt;span class="n"&gt;logger&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;error&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
&lt;a name="rest_code_5a62c5ca531948e5bd64635ffa75eaf9-101"&gt;&lt;/a&gt;                &lt;span class="s"&gt;u'[sync_event] Unexpected exception synchronizing event'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;a name="rest_code_5a62c5ca531948e5bd64635ffa75eaf9-102"&gt;&lt;/a&gt;                &lt;span class="n"&gt;exc_info&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="bp"&gt;True&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;extra&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;
&lt;a name="rest_code_5a62c5ca531948e5bd64635ffa75eaf9-103"&gt;&lt;/a&gt;                    &lt;span class="s"&gt;u'user'&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;a name="rest_code_5a62c5ca531948e5bd64635ffa75eaf9-104"&gt;&lt;/a&gt;                        &lt;span class="s"&gt;u'pk'&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;pk&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;a name="rest_code_5a62c5ca531948e5bd64635ffa75eaf9-105"&gt;&lt;/a&gt;                        &lt;span class="s"&gt;u'email'&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;email&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;a name="rest_code_5a62c5ca531948e5bd64635ffa75eaf9-106"&gt;&lt;/a&gt;                    &lt;span class="p"&gt;},&lt;/span&gt;
&lt;a name="rest_code_5a62c5ca531948e5bd64635ffa75eaf9-107"&gt;&lt;/a&gt;                    &lt;span class="s"&gt;u'provider'&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;a name="rest_code_5a62c5ca531948e5bd64635ffa75eaf9-108"&gt;&lt;/a&gt;                        &lt;span class="s"&gt;u'pk'&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;provider&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;pk&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;a name="rest_code_5a62c5ca531948e5bd64635ffa75eaf9-109"&gt;&lt;/a&gt;                        &lt;span class="s"&gt;u'extra_data'&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;provider&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;extra_data&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;a name="rest_code_5a62c5ca531948e5bd64635ffa75eaf9-110"&gt;&lt;/a&gt;                    &lt;span class="p"&gt;},&lt;/span&gt;
&lt;a name="rest_code_5a62c5ca531948e5bd64635ffa75eaf9-111"&gt;&lt;/a&gt;                    &lt;span class="s"&gt;u'event'&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;a name="rest_code_5a62c5ca531948e5bd64635ffa75eaf9-112"&gt;&lt;/a&gt;                        &lt;span class="s"&gt;u'pk'&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;pk&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;a name="rest_code_5a62c5ca531948e5bd64635ffa75eaf9-113"&gt;&lt;/a&gt;                        &lt;span class="s"&gt;u'name'&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;a name="rest_code_5a62c5ca531948e5bd64635ffa75eaf9-114"&gt;&lt;/a&gt;                    &lt;span class="p"&gt;},&lt;/span&gt;
&lt;a name="rest_code_5a62c5ca531948e5bd64635ffa75eaf9-115"&gt;&lt;/a&gt;                &lt;span class="p"&gt;})&lt;/span&gt;
&lt;a name="rest_code_5a62c5ca531948e5bd64635ffa75eaf9-116"&gt;&lt;/a&gt;
&lt;a name="rest_code_5a62c5ca531948e5bd64635ffa75eaf9-117"&gt;&lt;/a&gt;        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;retry&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;a name="rest_code_5a62c5ca531948e5bd64635ffa75eaf9-118"&gt;&lt;/a&gt;            &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sync_event&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;retry&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="bp"&gt;False&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a name="rest_code_5a62c5ca531948e5bd64635ffa75eaf9-119"&gt;&lt;/a&gt;
&lt;a name="rest_code_5a62c5ca531948e5bd64635ffa75eaf9-120"&gt;&lt;/a&gt;        &lt;span class="n"&gt;logger&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;debug&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;u'Event creation result: &lt;/span&gt;&lt;span class="si"&gt;%r&lt;/span&gt;&lt;span class="s"&gt;'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;result&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a name="rest_code_5a62c5ca531948e5bd64635ffa75eaf9-121"&gt;&lt;/a&gt;        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;result&lt;/span&gt;
&lt;/pre&gt;&lt;p&gt;¡Buen fin de semana! :)&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ACTUALIZACIÓN del 2014-11-11:&lt;/strong&gt; &lt;a class="reference external" href="http://psa.matiasaguirre.net/"&gt;python-social-auth&lt;/a&gt; ha actualizado la
documentación acerca de cómo renovar tokens: &lt;a class="reference external" href="http://psa.matiasaguirre.net/docs/use_cases.html#re-prompt-google-oauth2-users-to-refresh-the-refresh-token"&gt;http://psa.matiasaguirre.net/docs/use_cases.html#re-prompt-google-oauth2-users-to-refresh-the-refresh-token&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Hoy encontré que los refresh_tokens también expiran, así que el valor correcto
de &lt;tt class="docutils literal"&gt;approval_promt&lt;/tt&gt; a usar es &lt;tt class="docutils literal"&gt;auto&lt;/tt&gt;:&lt;/p&gt;
&lt;pre class="code python"&gt;&lt;a name="rest_code_b9beb51270ee4f3ca798a135ec71adeb-1"&gt;&lt;/a&gt;&lt;span class="n"&gt;SOCIAL_AUTH_GOOGLE_OAUTH2_AUTH_EXTRA_ARGUMENTS&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;a name="rest_code_b9beb51270ee4f3ca798a135ec71adeb-2"&gt;&lt;/a&gt;    &lt;span class="s"&gt;'access_type'&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s"&gt;'offline'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="c"&gt;# Activa el permiso de renovación&lt;/span&gt;
&lt;a name="rest_code_b9beb51270ee4f3ca798a135ec71adeb-3"&gt;&lt;/a&gt;    &lt;span class="s"&gt;'approval_promt'&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s"&gt;'auto'&lt;/span&gt;  &lt;span class="c"&gt;# Activa refresh_token, por siempre y para siempre&lt;/span&gt;
&lt;a name="rest_code_b9beb51270ee4f3ca798a135ec71adeb-4"&gt;&lt;/a&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;</description><category>google</category><category>oauth2</category><category>python</category><category>social</category><guid>http://ariel17.com.ar/blog/refreshing-tokens-on-django-for-google-oauth2-the-hard-way/</guid><pubDate>Thu, 30 Oct 2014 13:00:16 GMT</pubDate></item></channel></rss>